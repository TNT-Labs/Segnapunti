<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title data-i18n="app.title">Segnapunti - Gestione Preset</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <meta name="theme-color" content="#4A148C">

  <link rel="apple-touch-icon" href="Segnapunti192x192.png"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"> 

  <link rel="stylesheet" href="segnapunti.css">
  <link rel="stylesheet" href="preset-manager.css">
  <link rel="stylesheet" href="segnapunti-mobile.css">
  <link rel="stylesheet" href="utility-classes.css">

  <style>
    body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
    .loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .loader-spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid #4b86b4;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loader-overlay p { color: white; margin-top: 20px; }
  </style>

  <!-- i18next -->
  <script src="https://unpkg.com/i18next@23.0.1/i18next.min.js"></script>
  <script src="https://unpkg.com/i18next-http-backend@1.6.1/i18nextHttpBackend.min.js"></script>
  <script src="https://unpkg.com/i18next-browser-languagedetector@6.1.4/i18nextBrowserLanguageDetector.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header-controls fixed-header">
      <h1 data-i18n="app.preset_title">ğŸ® Gestione Preset</h1>
      <div class="top-buttons">
          <button id="toggle-dark-mode" title="Attiva/Disattiva ModalitÃ  Scura" aria-label="Attiva o disattiva modalitÃ  scura" onclick="toggleDarkMode()">ğŸŒ™</button>
      </div>
    </div>

    <!-- Selettore lingua -->
    <div class="language-selector">
      <label for="select-language" data-i18n="app.select_language">Lingua:</label>
      <select id="select-language">
        <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
      </select>
    </div>
    
    <!-- Toolbar -->
    <div class="preset-toolbar">
      <button id="btn-create-preset" class="btn-primary" data-i18n="app.new_preset">â• Nuovo Preset</button>
      
      <div class="preset-toolbar-actions">
        <button id="btn-import-presets" class="btn-secondary" title="Importa preset da file JSON" data-i18n="app.import">ğŸ“¥ Importa</button>
        <button id="btn-export-presets" class="btn-secondary" title="Esporta preset personalizzati" data-i18n="app.export">ğŸ“¤ Esporta</button>
        <button id="btn-restore-defaults" class="btn-reset" title="Elimina tutti i preset personalizzati" data-i18n="app.restore_defaults">ğŸ”„ Ripristina Default</button>
      </div>
    </div>

    <!-- Info Box -->
    <div class="info-box">
      <p><strong data-i18n="app.how_it_works">ğŸ’¡ Come funziona:</strong></p>
      <ul>
        <li data-i18n="app.preset_info_1">âœ… 17 preset predefiniti pronti all'uso (Scala 40, Briscola, Tennis, ecc.)</li>
        <li data-i18n="app.preset_info_2">â• Preset personalizzati illimitati per tutti gli utenti!</li>
        <li data-i18n="app.preset_info_3">âœï¸ Modifica i tuoi preset personalizzati</li>
        <li data-i18n="app.preset_info_4">ğŸ“‹ Duplica qualsiasi preset per usarlo come base</li>
        <li data-i18n="app.preset_info_5">ğŸ† ModalitÃ  Rounds: Imposta punteggio limite + chi vince (max/min) per determinare la fine di ogni round, poi scegli quanti round servono per vincere la partita</li>
        <li data-i18n="app.preset_info_6">ğŸ’¾ Esporta/Importa i tuoi preset per condividerli o fare backup</li>
      </ul>
    </div>

    <!-- Lista Preset -->
    <div id="preset-list-container" class="preset-list-container"></div>

  </div>

  <!-- Modal Crea/Modifica Preset -->
  <div id="preset-edit-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content modal-large">
      <h2 id="preset-modal-title" data-i18n="app.preset_modal_title">â• Nuovo Preset</h2>
      <form id="preset-form" onsubmit="return false;">
        <div class="form-row">
          <div class="form-group">
            <label for="preset-name" data-i18n="app.preset_name">Nome Gioco *</label>
            <input type="text" id="preset-name" placeholder="es: Mio Gioco Preferito" maxlength="50" required>
          </div>
          <div class="form-group">
            <label for="preset-mode" data-i18n="app.preset_mode">ModalitÃ  Vittoria *</label>
            <select id="preset-mode" required>
              <option value="max" data-i18n="app.preset_mode_max">Vince chi fa PIÃ™ punti</option>
              <option value="min" data-i18n="app.preset_mode_min">Vince chi fa MENO punti</option>
              <option value="rounds" data-i18n="app.preset_mode_rounds">Vince chi vince piÃ¹ ROUNDS</option>
              <option value="darts" data-i18n="app.preset_mode_darts">Freccette (da punteggio a 0)</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="preset-target" data-i18n="app.preset_target">Punteggio Obiettivo *</label>
            <input type="number" id="preset-target" min="0" max="999999" placeholder="es: 100" required>
          </div>
        </div>
        <div class="modal-action-buttons">
          <button type="button" id="btn-close-preset-modal" class="btn-reset" data-i18n="app.preset_cancel">Annulla</button>
          <button type="button" id="btn-save-preset" class="btn-primary" data-i18n="app.preset_save">ğŸ’¾ Salva Preset</button>
        </div>
      </form>
    </div>
  </div>

  <div id="loader-overlay" class="loader-overlay" style="display: flex;">
      <div class="loader-spinner"></div>
      <p data-i18n="app.loading">Caricamento preset...</p>
  </div>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-nav" role="navigation" aria-label="Navigazione principale">
    <a href="index.html" class="nav-item" aria-label="Partita"><span class="nav-icon" aria-hidden="true">ğŸƒ</span><span class="nav-label" data-i18n="app.nav_game">Partita</span></a>
    <a href="storico.html" class="nav-item" aria-label="Storico partite"><span class="nav-icon" aria-hidden="true">ğŸ“œ</span><span class="nav-label" data-i18n="app.nav_history">Storico</span></a>
    <a href="settings.html" class="nav-item" aria-label="Impostazioni"><span class="nav-icon" aria-hidden="true">âš™ï¸</span><span class="nav-label" data-i18n="app.nav_settings">Settings</span></a>
    <a href="preset-manager.html" class="nav-item active" aria-current="page" aria-label="Gestione preset (pagina corrente)"><span class="nav-icon" aria-hidden="true">ğŸ®</span><span class="nav-label" data-i18n="app.nav_preset">Preset</span></a>
    <a href="about.html" class="nav-item" aria-label="Info"><span class="nav-icon" aria-hidden="true">â„¹ï¸</span><span class="nav-label" data-i18n="app.nav_about">Info</span></a>
  </nav>

  <!-- Scripts -->
  <script src="polyfills.js"></script>
  <script src="logger.js"></script>
  <script src="error-handler.js"></script>
  <script src="dark-mode-toggle.js"></script>
  <script src="storage-helper.js"></script>
  <script src="preset-manager.js"></script>
  <script src="ads-module.js"></script>

  <script>
    // i18next initialization
    i18next
      .use(i18nextHttpBackend)
      .use(i18nextBrowserLanguageDetector)
      .init({
        fallbackLng: 'it',
        debug: false,
        backend: { loadPath: '/locales/{{lng}}/translation.json' }
      }, function(err, t) {
        if(err) console.error(err);
        updateContent();
      });

    function updateContent() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.innerHTML = i18next.t(key);
      });
    }

    document.getElementById('select-language').addEventListener('change', (e) => {
      i18next.changeLanguage(e.target.value, () => {
        updateContent();
      });
    });
  </script>
</body>
</html>
